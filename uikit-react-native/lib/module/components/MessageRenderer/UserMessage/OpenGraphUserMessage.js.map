{"version":3,"names":["React","useState","TouchableOpacity","View","Icon","Image","RegexText","Text","createStyleSheet","useUIKitTheme","conditionChaining","urlRegexRough","useLocalization","useSendbirdChat","useUserProfile","SBUUtils","OpenGraphUserMessage","_ref","_ogMetaData$defaultIm","message","variant","pressed","ogMetaData","children","onLongPressMentionedUser","onLongPressURL","mentionManager","currentUser","STRINGS","show","colors","select","palette","imageNotFound","setImageNotFound","color","ui","groupChannelMessage","containerBackground","dark","background400","light","background100","createElement","style","styles","bubbleContainer","backgroundColor","container","background","messageContainer","body3","textMsg","patterns","regex","templateRegex","replacer","_ref2","_message$mentionedUse","match","groups","parentProps","keyPrefix","index","user","mentionedUsers","find","it","userId","isCurrentUser","_extends","key","onPress","onLongPress","mentionedText","highlight","asMentionedMessageText","_ref3","openURL","urlText","shouldUseMentionedMessageTemplate","mentionedMessageTemplate","Boolean","updatedAt","textEdited","GROUP_CHANNEL","MESSAGE_BUBBLE_EDITED_POSTFIX","background500","background200","activeOpacity","url","ogImageContainer","containerStyle","ogImage","icon","size","onBackground02","source","uri","defaultImage","resizeMode","onError","ogContainer","numberOfLines","body2","onBackground01","ogTitle","title","description","caption2","ogDesc","borderRadius","overflow","width","maxWidth","paddingVertical","paddingHorizontal","paddingTop","paddingBottom","flex","height","marginBottom","lineHeight","fontWeight","textDecorationLine"],"sources":["OpenGraphUserMessage.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { TouchableOpacity, View } from 'react-native';\n\nimport type { OGMetaData } from '@sendbird/chat/message';\nimport { Icon, Image, RegexText, Text, createStyleSheet, useUIKitTheme } from '@sendbird/uikit-react-native-foundation';\nimport { conditionChaining, urlRegexRough } from '@sendbird/uikit-utils';\n\nimport { useLocalization, useSendbirdChat, useUserProfile } from '../../../hooks/useContext';\nimport SBUUtils from '../../../libs/SBUUtils';\nimport type { UserMessageProps } from './index';\n\ntype Props = UserMessageProps & {\n  ogMetaData: OGMetaData;\n};\n\nconst OpenGraphUserMessage = ({\n  message,\n  variant,\n  pressed,\n  ogMetaData,\n  children,\n  onLongPressMentionedUser,\n  onLongPressURL,\n}: Props) => {\n  const { mentionManager, currentUser } = useSendbirdChat();\n  const { STRINGS } = useLocalization();\n  const { show } = useUserProfile();\n  const { colors, select, palette } = useUIKitTheme();\n\n  const [imageNotFound, setImageNotFound] = useState(false);\n  const color = colors.ui.groupChannelMessage[variant][pressed ? 'pressed' : 'enabled'];\n\n  const containerBackground = select({ dark: palette.background400, light: palette.background100 });\n\n  return (\n    <View style={[styles.bubbleContainer, { backgroundColor: containerBackground }]}>\n      <View style={[styles.container, styles.bubbleContainer, { backgroundColor: color.background }]}>\n        <View style={styles.messageContainer}>\n          <Text body3 color={color.textMsg}>\n            <RegexText\n              body3\n              color={color.textMsg}\n              patterns={[\n                {\n                  regex: mentionManager.templateRegex,\n                  replacer({ match, groups, parentProps, keyPrefix, index }) {\n                    const user = message.mentionedUsers?.find((it) => it.userId === groups[2]);\n                    if (user) {\n                      const isCurrentUser = user.userId === currentUser?.userId;\n                      return (\n                        <Text\n                          {...parentProps}\n                          key={`${keyPrefix}-${index}`}\n                          onPress={() => show(user)}\n                          onLongPress={onLongPressMentionedUser}\n                          style={[\n                            parentProps?.style,\n                            styles.mentionedText,\n                            isCurrentUser && { backgroundColor: palette.highlight },\n                          ]}\n                        >\n                          {`${mentionManager.asMentionedMessageText(user)}`}\n                        </Text>\n                      );\n                    }\n                    return match;\n                  },\n                },\n                {\n                  regex: urlRegexRough,\n                  replacer({ match, parentProps, keyPrefix, index }) {\n                    return (\n                      <Text\n                        {...parentProps}\n                        key={`${keyPrefix}-${index}`}\n                        onPress={() => SBUUtils.openURL(match)}\n                        onLongPress={onLongPressURL}\n                        style={[parentProps?.style, styles.urlText]}\n                      >\n                        {match}\n                      </Text>\n                    );\n                  },\n                },\n              ]}\n            >\n              {mentionManager.shouldUseMentionedMessageTemplate(message)\n                ? message.mentionedMessageTemplate\n                : message.message}\n            </RegexText>\n            {Boolean(message.updatedAt) && (\n              <Text body3 color={color.textEdited}>\n                {STRINGS.GROUP_CHANNEL.MESSAGE_BUBBLE_EDITED_POSTFIX}\n              </Text>\n            )}\n          </Text>\n        </View>\n        <TouchableOpacity\n          style={{ backgroundColor: select({ dark: palette.background500, light: palette.background200 }) }}\n          activeOpacity={0.85}\n          onPress={() => SBUUtils.openURL(ogMetaData.url)}\n        >\n          <View\n            style={[\n              styles.ogImageContainer,\n              { backgroundColor: select({ dark: palette.background500, light: palette.background200 }) },\n            ]}\n          >\n            {conditionChaining(\n              [imageNotFound],\n              [\n                <Icon\n                  containerStyle={styles.ogImage}\n                  icon={'thumbnail-none'}\n                  size={48}\n                  color={colors.onBackground02}\n                />,\n                <Image\n                  source={{ uri: ogMetaData.defaultImage?.url }}\n                  style={styles.ogImage}\n                  resizeMode={'cover'}\n                  onError={() => setImageNotFound(true)}\n                />,\n              ],\n            )}\n          </View>\n          <View style={[styles.ogContainer, { backgroundColor: containerBackground }]}>\n            <Text numberOfLines={3} body2 color={colors.onBackground01} style={styles.ogTitle}>\n              {ogMetaData.title}\n            </Text>\n            {Boolean(ogMetaData.description) && (\n              <Text numberOfLines={1} caption2 color={colors.onBackground01} style={styles.ogDesc}>\n                {ogMetaData.description}\n              </Text>\n            )}\n            <Text numberOfLines={1} caption2 color={colors.onBackground02}>\n              {ogMetaData.url}\n            </Text>\n          </View>\n        </TouchableOpacity>\n      </View>\n      {children}\n    </View>\n  );\n};\n\nconst styles = createStyleSheet({\n  bubbleContainer: {\n    borderRadius: 16,\n    overflow: 'hidden',\n  },\n  container: {\n    width: 240,\n    maxWidth: 240,\n  },\n  messageContainer: {\n    paddingVertical: 6,\n    paddingHorizontal: 12,\n  },\n  ogContainer: {\n    paddingHorizontal: 12,\n    paddingTop: 8,\n    paddingBottom: 12,\n  },\n  ogImageContainer: {\n    flex: 1,\n    height: 136,\n  },\n  ogImage: {\n    width: '100%',\n    height: '100%',\n  },\n  ogTitle: {\n    marginBottom: 4,\n  },\n  ogDesc: {\n    lineHeight: 14,\n    marginBottom: 8,\n  },\n  mentionedText: {\n    fontWeight: 'bold',\n  },\n  urlText: {\n    textDecorationLine: 'underline',\n  },\n});\n\nexport default OpenGraphUserMessage;\n"],"mappings":";AAAA,OAAOA,KAAK,IAAIC,QAAQ,QAAQ,OAAO;AACvC,SAASC,gBAAgB,EAAEC,IAAI,QAAQ,cAAc;AAGrD,SAASC,IAAI,EAAEC,KAAK,EAAEC,SAAS,EAAEC,IAAI,EAAEC,gBAAgB,EAAEC,aAAa,QAAQ,yCAAyC;AACvH,SAASC,iBAAiB,EAAEC,aAAa,QAAQ,uBAAuB;AAExE,SAASC,eAAe,EAAEC,eAAe,EAAEC,cAAc,QAAQ,2BAA2B;AAC5F,OAAOC,QAAQ,MAAM,wBAAwB;AAO7C,MAAMC,oBAAoB,GAAGC,IAAA,IAQhB;EAAA,IAAAC,qBAAA;EAAA,IARiB;IAC5BC,OAAO;IACPC,OAAO;IACPC,OAAO;IACPC,UAAU;IACVC,QAAQ;IACRC,wBAAwB;IACxBC;EACK,CAAC,GAAAR,IAAA;EACN,MAAM;IAAES,cAAc;IAAEC;EAAY,CAAC,GAAGd,eAAe,EAAE;EACzD,MAAM;IAAEe;EAAQ,CAAC,GAAGhB,eAAe,EAAE;EACrC,MAAM;IAAEiB;EAAK,CAAC,GAAGf,cAAc,EAAE;EACjC,MAAM;IAAEgB,MAAM;IAAEC,MAAM;IAAEC;EAAQ,CAAC,GAAGvB,aAAa,EAAE;EAEnD,MAAM,CAACwB,aAAa,EAAEC,gBAAgB,CAAC,GAAGjC,QAAQ,CAAC,KAAK,CAAC;EACzD,MAAMkC,KAAK,GAAGL,MAAM,CAACM,EAAE,CAACC,mBAAmB,CAACjB,OAAO,CAAC,CAACC,OAAO,GAAG,SAAS,GAAG,SAAS,CAAC;EAErF,MAAMiB,mBAAmB,GAAGP,MAAM,CAAC;IAAEQ,IAAI,EAAEP,OAAO,CAACQ,aAAa;IAAEC,KAAK,EAAET,OAAO,CAACU;EAAc,CAAC,CAAC;EAEjG,oBACE1C,KAAA,CAAA2C,aAAA,CAACxC,IAAI;IAACyC,KAAK,EAAE,CAACC,MAAM,CAACC,eAAe,EAAE;MAAEC,eAAe,EAAET;IAAoB,CAAC;EAAE,gBAC9EtC,KAAA,CAAA2C,aAAA,CAACxC,IAAI;IAACyC,KAAK,EAAE,CAACC,MAAM,CAACG,SAAS,EAAEH,MAAM,CAACC,eAAe,EAAE;MAAEC,eAAe,EAAEZ,KAAK,CAACc;IAAW,CAAC;EAAE,gBAC7FjD,KAAA,CAAA2C,aAAA,CAACxC,IAAI;IAACyC,KAAK,EAAEC,MAAM,CAACK;EAAiB,gBACnClD,KAAA,CAAA2C,aAAA,CAACpC,IAAI;IAAC4C,KAAK;IAAChB,KAAK,EAAEA,KAAK,CAACiB;EAAQ,gBAC/BpD,KAAA,CAAA2C,aAAA,CAACrC,SAAS;IACR6C,KAAK;IACLhB,KAAK,EAAEA,KAAK,CAACiB,OAAQ;IACrBC,QAAQ,EAAE,CACR;MACEC,KAAK,EAAE5B,cAAc,CAAC6B,aAAa;MACnCC,QAAQA,CAAAC,KAAA,EAAmD;QAAA,IAAAC,qBAAA;QAAA,IAAlD;UAAEC,KAAK;UAAEC,MAAM;UAAEC,WAAW;UAAEC,SAAS;UAAEC;QAAM,CAAC,GAAAN,KAAA;QACvD,MAAMO,IAAI,IAAAN,qBAAA,GAAGvC,OAAO,CAAC8C,cAAc,cAAAP,qBAAA,uBAAtBA,qBAAA,CAAwBQ,IAAI,CAAEC,EAAE,IAAKA,EAAE,CAACC,MAAM,KAAKR,MAAM,CAAC,CAAC,CAAC,CAAC;QAC1E,IAAII,IAAI,EAAE;UACR,MAAMK,aAAa,GAAGL,IAAI,CAACI,MAAM,MAAKzC,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEyC,MAAM;UACzD,oBACEpE,KAAA,CAAA2C,aAAA,CAACpC,IAAI,EAAA+D,QAAA,KACCT,WAAW;YACfU,GAAG,EAAG,GAAET,SAAU,IAAGC,KAAM,EAAE;YAC7BS,OAAO,EAAEA,CAAA,KAAM3C,IAAI,CAACmC,IAAI,CAAE;YAC1BS,WAAW,EAAEjD,wBAAyB;YACtCoB,KAAK,EAAE,CACLiB,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEjB,KAAK,EAClBC,MAAM,CAAC6B,aAAa,EACpBL,aAAa,IAAI;cAAEtB,eAAe,EAAEf,OAAO,CAAC2C;YAAU,CAAC;UACvD,IAEA,GAAEjD,cAAc,CAACkD,sBAAsB,CAACZ,IAAI,CAAE,EAAC,CAC5C;QAEX;QACA,OAAOL,KAAK;MACd;IACF,CAAC,EACD;MACEL,KAAK,EAAE3C,aAAa;MACpB6C,QAAQA,CAAAqB,KAAA,EAA2C;QAAA,IAA1C;UAAElB,KAAK;UAAEE,WAAW;UAAEC,SAAS;UAAEC;QAAM,CAAC,GAAAc,KAAA;QAC/C,oBACE7E,KAAA,CAAA2C,aAAA,CAACpC,IAAI,EAAA+D,QAAA,KACCT,WAAW;UACfU,GAAG,EAAG,GAAET,SAAU,IAAGC,KAAM,EAAE;UAC7BS,OAAO,EAAEA,CAAA,KAAMzD,QAAQ,CAAC+D,OAAO,CAACnB,KAAK,CAAE;UACvCc,WAAW,EAAEhD,cAAe;UAC5BmB,KAAK,EAAE,CAACiB,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEjB,KAAK,EAAEC,MAAM,CAACkC,OAAO;QAAE,IAE3CpB,KAAK,CACD;MAEX;IACF,CAAC;EACD,GAEDjC,cAAc,CAACsD,iCAAiC,CAAC7D,OAAO,CAAC,GACtDA,OAAO,CAAC8D,wBAAwB,GAChC9D,OAAO,CAACA,OAAO,CACT,EACX+D,OAAO,CAAC/D,OAAO,CAACgE,SAAS,CAAC,iBACzBnF,KAAA,CAAA2C,aAAA,CAACpC,IAAI;IAAC4C,KAAK;IAAChB,KAAK,EAAEA,KAAK,CAACiD;EAAW,GACjCxD,OAAO,CAACyD,aAAa,CAACC,6BAA6B,CAEvD,CACI,CACF,eACPtF,KAAA,CAAA2C,aAAA,CAACzC,gBAAgB;IACf0C,KAAK,EAAE;MAAEG,eAAe,EAAEhB,MAAM,CAAC;QAAEQ,IAAI,EAAEP,OAAO,CAACuD,aAAa;QAAE9C,KAAK,EAAET,OAAO,CAACwD;MAAc,CAAC;IAAE,CAAE;IAClGC,aAAa,EAAE,IAAK;IACpBjB,OAAO,EAAEA,CAAA,KAAMzD,QAAQ,CAAC+D,OAAO,CAACxD,UAAU,CAACoE,GAAG;EAAE,gBAEhD1F,KAAA,CAAA2C,aAAA,CAACxC,IAAI;IACHyC,KAAK,EAAE,CACLC,MAAM,CAAC8C,gBAAgB,EACvB;MAAE5C,eAAe,EAAEhB,MAAM,CAAC;QAAEQ,IAAI,EAAEP,OAAO,CAACuD,aAAa;QAAE9C,KAAK,EAAET,OAAO,CAACwD;MAAc,CAAC;IAAE,CAAC;EAC1F,GAED9E,iBAAiB,CAChB,CAACuB,aAAa,CAAC,EACf,cACEjC,KAAA,CAAA2C,aAAA,CAACvC,IAAI;IACHwF,cAAc,EAAE/C,MAAM,CAACgD,OAAQ;IAC/BC,IAAI,EAAE,gBAAiB;IACvBC,IAAI,EAAE,EAAG;IACT5D,KAAK,EAAEL,MAAM,CAACkE;EAAe,EAC7B,eACFhG,KAAA,CAAA2C,aAAA,CAACtC,KAAK;IACJ4F,MAAM,EAAE;MAAEC,GAAG,GAAAhF,qBAAA,GAAEI,UAAU,CAAC6E,YAAY,cAAAjF,qBAAA,uBAAvBA,qBAAA,CAAyBwE;IAAI,CAAE;IAC9C9C,KAAK,EAAEC,MAAM,CAACgD,OAAQ;IACtBO,UAAU,EAAE,OAAQ;IACpBC,OAAO,EAAEA,CAAA,KAAMnE,gBAAgB,CAAC,IAAI;EAAE,EACtC,CACH,CACF,CACI,eACPlC,KAAA,CAAA2C,aAAA,CAACxC,IAAI;IAACyC,KAAK,EAAE,CAACC,MAAM,CAACyD,WAAW,EAAE;MAAEvD,eAAe,EAAET;IAAoB,CAAC;EAAE,gBAC1EtC,KAAA,CAAA2C,aAAA,CAACpC,IAAI;IAACgG,aAAa,EAAE,CAAE;IAACC,KAAK;IAACrE,KAAK,EAAEL,MAAM,CAAC2E,cAAe;IAAC7D,KAAK,EAAEC,MAAM,CAAC6D;EAAQ,GAC/EpF,UAAU,CAACqF,KAAK,CACZ,EACNzB,OAAO,CAAC5D,UAAU,CAACsF,WAAW,CAAC,iBAC9B5G,KAAA,CAAA2C,aAAA,CAACpC,IAAI;IAACgG,aAAa,EAAE,CAAE;IAACM,QAAQ;IAAC1E,KAAK,EAAEL,MAAM,CAAC2E,cAAe;IAAC7D,KAAK,EAAEC,MAAM,CAACiE;EAAO,GACjFxF,UAAU,CAACsF,WAAW,CAE1B,eACD5G,KAAA,CAAA2C,aAAA,CAACpC,IAAI;IAACgG,aAAa,EAAE,CAAE;IAACM,QAAQ;IAAC1E,KAAK,EAAEL,MAAM,CAACkE;EAAe,GAC3D1E,UAAU,CAACoE,GAAG,CACV,CACF,CACU,CACd,EACNnE,QAAQ,CACJ;AAEX,CAAC;AAED,MAAMsB,MAAM,GAAGrC,gBAAgB,CAAC;EAC9BsC,eAAe,EAAE;IACfiE,YAAY,EAAE,EAAE;IAChBC,QAAQ,EAAE;EACZ,CAAC;EACDhE,SAAS,EAAE;IACTiE,KAAK,EAAE,GAAG;IACVC,QAAQ,EAAE;EACZ,CAAC;EACDhE,gBAAgB,EAAE;IAChBiE,eAAe,EAAE,CAAC;IAClBC,iBAAiB,EAAE;EACrB,CAAC;EACDd,WAAW,EAAE;IACXc,iBAAiB,EAAE,EAAE;IACrBC,UAAU,EAAE,CAAC;IACbC,aAAa,EAAE;EACjB,CAAC;EACD3B,gBAAgB,EAAE;IAChB4B,IAAI,EAAE,CAAC;IACPC,MAAM,EAAE;EACV,CAAC;EACD3B,OAAO,EAAE;IACPoB,KAAK,EAAE,MAAM;IACbO,MAAM,EAAE;EACV,CAAC;EACDd,OAAO,EAAE;IACPe,YAAY,EAAE;EAChB,CAAC;EACDX,MAAM,EAAE;IACNY,UAAU,EAAE,EAAE;IACdD,YAAY,EAAE;EAChB,CAAC;EACD/C,aAAa,EAAE;IACbiD,UAAU,EAAE;EACd,CAAC;EACD5C,OAAO,EAAE;IACP6C,kBAAkB,EAAE;EACtB;AACF,CAAC,CAAC;AAEF,eAAe5G,oBAAoB"}