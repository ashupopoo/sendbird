{"version":3,"names":["React","useEffect","useRef","useState","View","Icon","Image","createStyleSheet","useUIKitTheme","getAvailableUriFromFileMessage","usePlatformService","useRetry","videoFileUrl","retryCount","arguments","length","undefined","state","setState","thumbnail","loading","retryCountRef","retryTimeoutRef","mediaService","fetchThumbnail","getVideoThumbnail","url","timeMills","then","result","path","reloadReservation","current","setTimeout","clearTimeout","VideoFileMessage","_ref","message","variant","children","colors","fileUrl","style","styles","video","backgroundColor","onBackground04","createElement","bubbleContainer","ui","groupChannelMessage","enabled","background","bubbleInnerContainer","PlayIcon","source","uri","resizeMode","resizeMethod","icon","size","color","onBackground02","containerStyle","playIcon","onBackgroundReverse01","borderRadius","overflow","alignItems","justifyContent","width","maxWidth","height","position","padding"],"sources":["VideoFileMessage.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { View } from 'react-native';\n\nimport { Icon, Image, createStyleSheet, useUIKitTheme } from '@sendbird/uikit-react-native-foundation';\nimport { getAvailableUriFromFileMessage } from '@sendbird/uikit-utils';\n\nimport { usePlatformService } from '../../../hooks/useContext';\nimport type { FileMessageProps } from './index';\n\nconst useRetry = (videoFileUrl: string, retryCount = 5) => {\n  const [state, setState] = useState({ thumbnail: null as null | string, loading: true });\n  const retryCountRef = useRef(0);\n  const retryTimeoutRef = useRef<NodeJS.Timeout>();\n\n  const { mediaService } = usePlatformService();\n\n  const fetchThumbnail = () => {\n    return mediaService.getVideoThumbnail({ url: videoFileUrl, timeMills: 1000 }).then((result) => {\n      setState({ loading: false, thumbnail: result?.path ?? null });\n    });\n  };\n\n  useEffect(() => {\n    if (!state.thumbnail) {\n      const reloadReservation = () => {\n        if (retryCountRef.current < retryCount) {\n          retryTimeoutRef.current = setTimeout(() => {\n            retryCountRef.current++;\n            reloadReservation();\n            fetchThumbnail();\n          }, retryCountRef.current * 5000);\n        }\n      };\n\n      return reloadReservation();\n    } else {\n      return clearTimeout(retryTimeoutRef.current);\n    }\n  }, [state.thumbnail]);\n\n  return state;\n};\n\nconst VideoFileMessage = ({ message, variant, children }: FileMessageProps) => {\n  const { colors } = useUIKitTheme();\n\n  const fileUrl = getAvailableUriFromFileMessage(message);\n  const style = [styles.video, { backgroundColor: colors.onBackground04 }];\n\n  const { loading, thumbnail } = useRetry(fileUrl);\n\n  if (loading) {\n    return (\n      <View\n        style={[styles.bubbleContainer, { backgroundColor: colors.ui.groupChannelMessage[variant].enabled.background }]}\n      >\n        <View style={[styles.bubbleContainer, styles.bubbleInnerContainer]}>\n          <View style={style} />\n          <PlayIcon />\n        </View>\n        {children}\n      </View>\n    );\n  }\n\n  return (\n    <View\n      style={[styles.bubbleContainer, { backgroundColor: colors.ui.groupChannelMessage[variant].enabled.background }]}\n    >\n      <View style={[styles.bubbleContainer, styles.bubbleInnerContainer]}>\n        <Image source={{ uri: thumbnail || fileUrl }} style={style} resizeMode={'cover'} resizeMethod={'resize'} />\n        <PlayIcon />\n      </View>\n      {children}\n    </View>\n  );\n};\n\nconst PlayIcon = () => {\n  const { colors } = useUIKitTheme();\n\n  return (\n    <Icon\n      icon={'play'}\n      size={28}\n      color={colors.onBackground02}\n      containerStyle={[styles.playIcon, { backgroundColor: colors.onBackgroundReverse01 }]}\n    />\n  );\n};\n\nconst styles = createStyleSheet({\n  bubbleContainer: {\n    borderRadius: 16,\n    overflow: 'hidden',\n  },\n  bubbleInnerContainer: {\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n  video: {\n    width: 240,\n    maxWidth: 240,\n    height: 160,\n  },\n  playIcon: {\n    position: 'absolute',\n    padding: 10,\n    borderRadius: 50,\n  },\n});\n\nexport default VideoFileMessage;\n"],"mappings":"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"}