{"version":3,"names":["React","View","useSafeAreaInsets","ChannelFrozenBanner","createStyleSheet","useAlert","useBottomSheet","useToast","useUIKitTheme","Logger","getAvailableUriFromFileMessage","getFileExtension","getFileType","isMyMessage","messageKeyExtractor","shouldRenderReaction","toMegabyte","useFreshCallback","DEPRECATION_WARNING","useLocalization","usePlatformService","useSendbirdChat","SBUUtils","ChatFlatList","ReactionAddons","ChannelMessageList","_ref","ref","searchItem","hasNext","channel","onEditMessage","onDeleteMessage","onResendFailedMessage","onPressMediaMessage","currentUserId","renderNewMessagesButton","renderScrollToBottomButton","renderMessage","messages","newMessages","enableMessageGrouping","onScrolledAwayFromBottom","scrolledAwayFromBottom","onBottomReached","onTopReached","flatListProps","onPressNewMessagesButton","onPressScrollToBottomButton","onPressImageMessage","STRINGS","colors","left","right","getMessagePressActions","useGetMessagePressActions","safeAreaLayout","paddingLeft","paddingRight","renderItem","_ref2","item","index","onPress","onLongPress","message","prevMessage","nextMessage","focused","startingPoint","createdAt","createElement","style","flex","backgroundColor","background","isFrozen","styles","frozenBanner","text","LABELS","CHANNEL_MESSAGE_LIST_FROZEN","_extends","data","keyExtractor","contentContainerStyle","frozenListPadding","newMsgButton","visible","length","scrollButton","_ref3","toast","openSheet","alert","clipboardService","fileService","features","handleFailedMessage","sheetItems","title","CHANNEL_MESSAGE_FAILED_RETRY","catch","show","TOAST","RESEND_MSG_ERROR","CHANNEL_MESSAGE_FAILED_REMOVE","titleColor","ui","dialog","default","none","destructive","confirmDelete","CHANNEL_MESSAGE_DELETE_CONFIRM_TITLE","buttons","CHANNEL_MESSAGE_DELETE_CONFIRM_CANCEL","CHANNEL_MESSAGE_DELETE_CONFIRM_OK","DELETE_MSG_ERROR","msg","isUserMessage","isFileMessage","undefined","response","push","icon","CHANNEL_MESSAGE_COPY","setString","COPY_OK","sendingStatus","CHANNEL_MESSAGE_EDIT","CHANNEL_MESSAGE_DELETE","CHANNEL_MESSAGE_SAVE","size","DOWNLOAD_START","save","fileUrl","url","fileName","name","fileType","type","then","DOWNLOAD_OK","log","err","DOWNLOAD_ERROR","warn","CHANNEL","ON_PRESS_IMAGE_MESSAGE","openURL","HeaderComponent","reactionEnabled","_ref4","onClose","BottomSheet","position","zIndex","top","paddingBottom","bottom","alignSelf","forwardRef"],"sources":["index.tsx"],"sourcesContent":["import React, { Ref } from 'react';\nimport { FlatList, FlatListProps, ListRenderItem, View } from 'react-native';\nimport { useSafeAreaInsets } from 'react-native-safe-area-context';\n\nimport {\n  BottomSheetItem,\n  ChannelFrozenBanner,\n  createStyleSheet,\n  useAlert,\n  useBottomSheet,\n  useToast,\n  useUIKitTheme,\n} from '@sendbird/uikit-react-native-foundation';\nimport {\n  Logger,\n  SendbirdFileMessage,\n  SendbirdGroupChannel,\n  SendbirdMessage,\n  SendbirdOpenChannel,\n  SendbirdUserMessage,\n  getAvailableUriFromFileMessage,\n  getFileExtension,\n  getFileType,\n  isMyMessage,\n  messageKeyExtractor,\n  shouldRenderReaction,\n  toMegabyte,\n  useFreshCallback,\n} from '@sendbird/uikit-utils';\n\nimport { DEPRECATION_WARNING } from '../../constants';\nimport type { UserProfileContextType } from '../../contexts/UserProfileCtx';\nimport { useLocalization, usePlatformService, useSendbirdChat } from '../../hooks/useContext';\nimport SBUUtils from '../../libs/SBUUtils';\nimport type { CommonComponent } from '../../types';\nimport ChatFlatList from '../ChatFlatList';\nimport { ReactionAddons } from '../ReactionAddons';\n\ntype PressActions = { onPress?: () => void; onLongPress?: () => void };\ntype HandleableMessage = SendbirdUserMessage | SendbirdFileMessage;\nexport type ChannelMessageListProps<T extends SendbirdGroupChannel | SendbirdOpenChannel> = {\n  enableMessageGrouping: boolean;\n  currentUserId?: string;\n  channel: T;\n  messages: SendbirdMessage[];\n  newMessages: SendbirdMessage[];\n  searchItem?: { startingPoint: number };\n\n  scrolledAwayFromBottom: boolean;\n  onScrolledAwayFromBottom: (value: boolean) => void;\n  onTopReached: () => void;\n  onBottomReached: () => void;\n  hasNext: () => boolean;\n\n  onPressNewMessagesButton: (animated?: boolean) => void;\n  onPressScrollToBottomButton: (animated?: boolean) => void;\n\n  onEditMessage: (message: HandleableMessage) => void;\n  onDeleteMessage: (message: HandleableMessage) => Promise<void>;\n  onResendFailedMessage: (failedMessage: HandleableMessage) => Promise<void>;\n  onPressMediaMessage?: (message: SendbirdFileMessage, deleteMessage: () => Promise<void>, uri: string) => void;\n\n  renderMessage: (props: {\n    focused: boolean;\n    message: SendbirdMessage;\n    prevMessage?: SendbirdMessage;\n    nextMessage?: SendbirdMessage;\n    onPress?: () => void;\n    onLongPress?: () => void;\n    onPressAvatar?: UserProfileContextType['show'];\n    channel: T;\n    currentUserId?: ChannelMessageListProps<T>['currentUserId'];\n    enableMessageGrouping: ChannelMessageListProps<T>['enableMessageGrouping'];\n  }) => React.ReactElement | null;\n  renderNewMessagesButton: null | CommonComponent<{\n    visible: boolean;\n    onPress: () => void;\n    newMessages: SendbirdMessage[];\n  }>;\n  renderScrollToBottomButton: null | CommonComponent<{\n    visible: boolean;\n    onPress: () => void;\n  }>;\n  flatListProps?: Omit<FlatListProps<SendbirdMessage>, 'data' | 'renderItem'>;\n\n  /** @deprecated Please use `onPressMediaMessage` instead **/\n  onPressImageMessage?: (message: SendbirdFileMessage, uri: string) => void;\n} & {\n  ref?: Ref<FlatList<SendbirdMessage>> | undefined;\n};\n\nconst ChannelMessageList = <T extends SendbirdGroupChannel | SendbirdOpenChannel>(\n  {\n    searchItem,\n    hasNext,\n    channel,\n    onEditMessage,\n    onDeleteMessage,\n    onResendFailedMessage,\n    onPressMediaMessage,\n    currentUserId,\n    renderNewMessagesButton,\n    renderScrollToBottomButton,\n    renderMessage,\n    messages,\n    newMessages,\n    enableMessageGrouping,\n    onScrolledAwayFromBottom,\n    scrolledAwayFromBottom,\n    onBottomReached,\n    onTopReached,\n    flatListProps,\n    onPressNewMessagesButton,\n    onPressScrollToBottomButton,\n    onPressImageMessage,\n  }: ChannelMessageListProps<T>,\n  ref: React.ForwardedRef<FlatList<SendbirdMessage>>,\n) => {\n  const { STRINGS } = useLocalization();\n  const { colors } = useUIKitTheme();\n  const { left, right } = useSafeAreaInsets();\n  const getMessagePressActions = useGetMessagePressActions({\n    channel,\n    currentUserId,\n    onEditMessage,\n    onDeleteMessage,\n    onResendFailedMessage,\n    onPressImageMessage,\n    onPressMediaMessage,\n  });\n\n  const safeAreaLayout = { paddingLeft: left, paddingRight: right };\n\n  const renderItem: ListRenderItem<SendbirdMessage> = useFreshCallback(({ item, index }) => {\n    const { onPress, onLongPress } = getMessagePressActions(item);\n    return renderMessage({\n      message: item,\n      prevMessage: messages[index + 1],\n      nextMessage: messages[index - 1],\n      onPress,\n      onLongPress,\n      enableMessageGrouping,\n      channel,\n      currentUserId,\n      focused: (searchItem?.startingPoint ?? -1) === item.createdAt,\n    });\n  });\n\n  return (\n    <View style={[{ flex: 1, backgroundColor: colors.background }, safeAreaLayout]}>\n      {channel.isFrozen && (\n        <ChannelFrozenBanner style={styles.frozenBanner} text={STRINGS.LABELS.CHANNEL_MESSAGE_LIST_FROZEN} />\n      )}\n      <ChatFlatList\n        {...flatListProps}\n        onTopReached={onTopReached}\n        onBottomReached={onBottomReached}\n        onScrolledAwayFromBottom={onScrolledAwayFromBottom}\n        ref={ref}\n        data={messages}\n        renderItem={renderItem}\n        keyExtractor={messageKeyExtractor}\n        contentContainerStyle={[\n          // { minHeight: '100%', justifyContent: 'flex-end' },\n          channel.isFrozen && styles.frozenListPadding,\n          flatListProps?.contentContainerStyle,\n        ]}\n      />\n      {renderNewMessagesButton && (\n        <View style={[styles.newMsgButton, safeAreaLayout]}>\n          {renderNewMessagesButton({\n            visible: newMessages.length > 0 && (hasNext() || scrolledAwayFromBottom),\n            onPress: () => onPressNewMessagesButton(),\n            newMessages,\n          })}\n        </View>\n      )}\n      {renderScrollToBottomButton && (\n        <View style={[styles.scrollButton, safeAreaLayout]}>\n          {renderScrollToBottomButton({\n            visible: hasNext() || scrolledAwayFromBottom,\n            onPress: () => onPressScrollToBottomButton(),\n          })}\n        </View>\n      )}\n    </View>\n  );\n};\n\nconst useGetMessagePressActions = <T extends SendbirdGroupChannel | SendbirdOpenChannel>({\n  channel,\n  currentUserId,\n  onResendFailedMessage,\n  onEditMessage,\n  onDeleteMessage,\n  onPressImageMessage,\n  onPressMediaMessage,\n}: Pick<\n  ChannelMessageListProps<T>,\n  | 'channel'\n  | 'currentUserId'\n  | 'onEditMessage'\n  | 'onDeleteMessage'\n  | 'onResendFailedMessage'\n  | 'onPressImageMessage'\n  | 'onPressMediaMessage'\n>) => {\n  const { colors } = useUIKitTheme();\n  const { STRINGS } = useLocalization();\n  const toast = useToast();\n  const { openSheet } = useBottomSheet();\n  const { alert } = useAlert();\n  const { clipboardService, fileService } = usePlatformService();\n  const { features } = useSendbirdChat();\n\n  const handleFailedMessage = (message: HandleableMessage) => {\n    openSheet({\n      sheetItems: [\n        {\n          title: STRINGS.LABELS.CHANNEL_MESSAGE_FAILED_RETRY,\n          onPress: () => {\n            onResendFailedMessage(message).catch(() => toast.show(STRINGS.TOAST.RESEND_MSG_ERROR, 'error'));\n          },\n        },\n        {\n          title: STRINGS.LABELS.CHANNEL_MESSAGE_FAILED_REMOVE,\n          titleColor: colors.ui.dialog.default.none.destructive,\n          onPress: () => confirmDelete(message),\n        },\n      ],\n    });\n  };\n  const confirmDelete = (message: HandleableMessage) => {\n    alert({\n      title: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE_CONFIRM_TITLE,\n      buttons: [\n        {\n          text: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE_CONFIRM_CANCEL,\n        },\n        {\n          text: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE_CONFIRM_OK,\n          style: 'destructive',\n          onPress: () => {\n            onDeleteMessage(message).catch(() => toast.show(STRINGS.TOAST.DELETE_MSG_ERROR, 'error'));\n          },\n        },\n      ],\n    });\n  };\n\n  return (msg: SendbirdMessage) => {\n    if (!msg.isUserMessage() && !msg.isFileMessage()) {\n      return { onPress: undefined, onLongPress: undefined };\n    }\n\n    const sheetItems: BottomSheetItem['sheetItems'] = [];\n    const response: PressActions = {\n      onPress: undefined,\n      onLongPress: undefined,\n    };\n\n    if (msg.isUserMessage()) {\n      sheetItems.push({\n        icon: 'copy',\n        title: STRINGS.LABELS.CHANNEL_MESSAGE_COPY,\n        onPress: () => {\n          clipboardService.setString(msg.message || '');\n          toast.show(STRINGS.TOAST.COPY_OK, 'success');\n        },\n      });\n\n      if (isMyMessage(msg, currentUserId) && msg.sendingStatus === 'succeeded') {\n        sheetItems.push(\n          {\n            icon: 'edit',\n            title: STRINGS.LABELS.CHANNEL_MESSAGE_EDIT,\n            onPress: () => onEditMessage(msg),\n          },\n          {\n            icon: 'delete',\n            title: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE,\n            onPress: () => confirmDelete(msg),\n          },\n        );\n      }\n    }\n\n    if (msg.isFileMessage()) {\n      sheetItems.push({\n        icon: 'download',\n        title: STRINGS.LABELS.CHANNEL_MESSAGE_SAVE,\n        onPress: async () => {\n          if (toMegabyte(msg.size) > 4) {\n            toast.show(STRINGS.TOAST.DOWNLOAD_START, 'success');\n          }\n\n          fileService\n            .save({ fileUrl: msg.url, fileName: msg.name, fileType: msg.type })\n            .then((response) => {\n              toast.show(STRINGS.TOAST.DOWNLOAD_OK, 'success');\n              Logger.log('File saved to', response);\n            })\n            .catch((err) => {\n              toast.show(STRINGS.TOAST.DOWNLOAD_ERROR, 'error');\n              Logger.log('File save failure', err);\n            });\n        },\n      });\n\n      if (isMyMessage(msg, currentUserId) && msg.sendingStatus === 'succeeded') {\n        sheetItems.push({\n          icon: 'delete',\n          title: STRINGS.LABELS.CHANNEL_MESSAGE_DELETE,\n          onPress: () => confirmDelete(msg),\n        });\n      }\n\n      const fileType = getFileType(msg.type || getFileExtension(msg.name));\n      switch (fileType) {\n        case 'image':\n        case 'video':\n        case 'audio': {\n          response.onPress = () => {\n            if (onPressImageMessage && fileType === 'image') {\n              Logger.warn(DEPRECATION_WARNING.CHANNEL.ON_PRESS_IMAGE_MESSAGE);\n              onPressImageMessage(msg, getAvailableUriFromFileMessage(msg));\n            }\n            onPressMediaMessage?.(msg, () => onDeleteMessage(msg), getAvailableUriFromFileMessage(msg));\n          };\n          break;\n        }\n        default: {\n          response.onPress = () => SBUUtils.openURL(msg.url);\n          break;\n        }\n      }\n    }\n\n    if (sheetItems.length > 0) {\n      response.onLongPress = () => {\n        openSheet({\n          sheetItems,\n          HeaderComponent: shouldRenderReaction(channel, features.reactionEnabled)\n            ? ({ onClose }) => <ReactionAddons.BottomSheet message={msg} channel={channel} onClose={onClose} />\n            : undefined,\n        });\n      };\n    }\n\n    if (msg.sendingStatus === 'failed') {\n      response.onLongPress = () => handleFailedMessage(msg);\n      response.onPress = () => {\n        onResendFailedMessage(msg).catch(() => toast.show(STRINGS.TOAST.RESEND_MSG_ERROR, 'error'));\n      };\n    }\n\n    if (msg.sendingStatus === 'pending') {\n      response.onLongPress = undefined;\n      response.onPress = undefined;\n    }\n\n    return response;\n  };\n};\n\nconst styles = createStyleSheet({\n  frozenBanner: {\n    position: 'absolute',\n    zIndex: 999,\n    top: 8,\n    left: 8,\n    right: 8,\n  },\n  frozenListPadding: {\n    paddingBottom: 32,\n  },\n  newMsgButton: {\n    position: 'absolute',\n    zIndex: 999,\n    bottom: 10,\n    alignSelf: 'center',\n  },\n  scrollButton: {\n    position: 'absolute',\n    zIndex: 998,\n    bottom: 10,\n    right: 16,\n  },\n});\n\n// NOTE: Due to Generic inference is not working on forwardRef, we need to cast it as typeof ChannelMessageList and implicit `ref` prop\nexport default React.forwardRef(ChannelMessageList) as typeof ChannelMessageList;\n"],"mappings":"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"}