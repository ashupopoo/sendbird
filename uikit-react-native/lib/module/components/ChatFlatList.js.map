{"version":3,"names":["React","forwardRef","useRef","Platform","StyleSheet","FlatList","useUIKitTheme","NOOP","getMessageUniqId","useFreshCallback","ANDROID_BUG_ALERT_SHOWED","OS","BOTTOM_DETECT_THRESHOLD","UNREACHABLE_THRESHOLD","Number","MIN_SAFE_INTEGER","ChatFlatList","CustomFlatList","_ref","ref","_props$data","onTopReached","onBottomReached","onScrolledAwayFromBottom","onLeaveScrollBottom","onScroll","props","select","contentOffsetY","_onScroll","event","contentOffset","nativeEvent","prevOffsetY","current","currOffsetY","y","__DEV__","console","warn","createElement","_extends","bounces","removeClippedSubviews","keyboardDismissMode","keyboardShouldPersistTaps","indicatorStyle","light","dark","inverted","Boolean","data","length","onEndReached","onScrollToIndexFailed","onStartReached","scrollEventThrottle","keyExtractor","style","flex","flatten","maintainVisibleContentPosition","minIndexForVisible","autoscrollToTopThreshold"],"sources":["ChatFlatList.tsx"],"sourcesContent":["import React, { forwardRef, useRef } from 'react';\nimport { FlatListProps, Platform, FlatList as RNFlatList, StyleSheet } from 'react-native';\n\nimport { FlatList } from '@sendbird/react-native-scrollview-enhancer';\nimport { useUIKitTheme } from '@sendbird/uikit-react-native-foundation';\nimport { NOOP, SendbirdMessage, getMessageUniqId, useFreshCallback } from '@sendbird/uikit-utils';\n\nlet ANDROID_BUG_ALERT_SHOWED = Platform.OS !== 'android';\nconst BOTTOM_DETECT_THRESHOLD = 25;\nconst UNREACHABLE_THRESHOLD = Number.MIN_SAFE_INTEGER;\n\ntype Props = Omit<FlatListProps<SendbirdMessage>, 'onEndReached'> & {\n  onBottomReached: () => void;\n  onTopReached: () => void;\n  onScrolledAwayFromBottom: (value: boolean) => void;\n\n  /** @deprecated Please use `onScrolledAwayFromBottom` **/\n  onLeaveScrollBottom?: (value: boolean) => void;\n  /** @deprecated Not used anymore **/\n  nextMessages?: unknown;\n};\n// FIXME: Inverted FlatList performance issue on Android {@link https://github.com/facebook/react-native/issues/30034}\nconst ChatFlatList = forwardRef<RNFlatList<SendbirdMessage>, Props>(function CustomFlatList(\n  { onTopReached, onBottomReached, onScrolledAwayFromBottom, onLeaveScrollBottom, onScroll, ...props },\n  ref,\n) {\n  const { select } = useUIKitTheme();\n  const contentOffsetY = useRef(0);\n\n  const _onScroll = useFreshCallback<NonNullable<Props['onScroll']>>((event) => {\n    onScroll?.(event);\n\n    const { contentOffset } = event.nativeEvent;\n\n    const prevOffsetY = contentOffsetY.current;\n    const currOffsetY = contentOffset.y;\n\n    if (BOTTOM_DETECT_THRESHOLD < prevOffsetY && currOffsetY <= BOTTOM_DETECT_THRESHOLD) {\n      onScrolledAwayFromBottom(false);\n      onLeaveScrollBottom?.(false);\n    } else if (BOTTOM_DETECT_THRESHOLD < currOffsetY && prevOffsetY <= BOTTOM_DETECT_THRESHOLD) {\n      onScrolledAwayFromBottom(true);\n      onLeaveScrollBottom?.(true);\n    }\n\n    contentOffsetY.current = contentOffset.y;\n  });\n\n  if (__DEV__ && !ANDROID_BUG_ALERT_SHOWED) {\n    ANDROID_BUG_ALERT_SHOWED = true;\n    // eslint-disable-next-line no-console\n    console.warn(\n      'UIKit Warning: Inverted FlatList has a performance issue on Android, Maybe this is a bug please refer link\\nhttps://github.com/facebook/react-native/issues/30034',\n    );\n  }\n\n  return (\n    <FlatList\n      bounces={false}\n      removeClippedSubviews\n      keyboardDismissMode={'on-drag'}\n      keyboardShouldPersistTaps={'handled'}\n      indicatorStyle={select({ light: 'black', dark: 'white' })}\n      {...props}\n      // FIXME: inverted list of ListEmptyComponent is reversed {@link https://github.com/facebook/react-native/issues/21196#issuecomment-836937743}\n      inverted={Boolean(props.data?.length)}\n      ref={ref}\n      onEndReached={onTopReached}\n      onScrollToIndexFailed={NOOP}\n      onStartReached={onBottomReached}\n      scrollEventThrottle={16}\n      onScroll={_onScroll}\n      keyExtractor={getMessageUniqId}\n      style={{ flex: 1, ...StyleSheet.flatten(props.style) }}\n      maintainVisibleContentPosition={{ minIndexForVisible: 0, autoscrollToTopThreshold: UNREACHABLE_THRESHOLD }}\n    />\n  );\n});\n\nexport default ChatFlatList;\n"],"mappings":"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"}