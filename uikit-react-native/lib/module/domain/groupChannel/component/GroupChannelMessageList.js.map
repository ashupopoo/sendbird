{"version":3,"names":["React","useContext","useEffect","useRef","useChannelHandler","isDifferentChannel","useFreshCallback","useUniqHandlerId","ChannelMessageList","MESSAGE_SEARCH_SAFE_SCROLL_DELAY","useSendbirdChat","GroupChannelContexts","GroupChannelMessageList","props","sdk","setMessageToEdit","Fragment","subscribe","PubSub","id","ref","lazyScrollToBottom","animated","arguments","length","undefined","timeout","setTimeout","_ref$current","current","scrollToOffset","offset","lazyScrollToIndex","index","_ref$current2","scrollToIndex","viewPosition","searchItem","createdAt","startingPoint","foundMessageIndex","messages","findIndex","it","isIncludedInList","scrollToBottom","hasNext","onResetMessageList","onScrolledAwayFromBottom","onReactionUpdated","channel","event","recentMessage","isRecentMessage","messageId","scrollReachedBottomAndCanScroll","scrolledAwayFromBottom","_ref","type","createElement","_extends","onEditMessage","onPressNewMessagesButton","onPressScrollToBottomButton","memo"],"sources":["GroupChannelMessageList.tsx"],"sourcesContent":["import React, { useContext, useEffect, useRef } from 'react';\nimport type { FlatList } from 'react-native';\n\nimport { useChannelHandler } from '@sendbird/uikit-chat-hooks';\nimport type { SendbirdMessage } from '@sendbird/uikit-utils';\nimport { isDifferentChannel, useFreshCallback, useUniqHandlerId } from '@sendbird/uikit-utils';\n\nimport ChannelMessageList from '../../../components/ChannelMessageList';\nimport { MESSAGE_SEARCH_SAFE_SCROLL_DELAY } from '../../../constants';\nimport { useSendbirdChat } from '../../../hooks/useContext';\nimport { GroupChannelContexts } from '../module/moduleContext';\nimport type { GroupChannelProps } from '../types';\n\nconst GroupChannelMessageList = (props: GroupChannelProps['MessageList']) => {\n  const { sdk } = useSendbirdChat();\n  const { setMessageToEdit } = useContext(GroupChannelContexts.Fragment);\n  const { subscribe } = useContext(GroupChannelContexts.PubSub);\n\n  const id = useUniqHandlerId('GroupChannelMessageList');\n  const ref = useRef<FlatList<SendbirdMessage>>(null);\n\n  // FIXME: Workaround, should run after data has been applied to UI.\n  const lazyScrollToBottom = (animated = false, timeout = 0) => {\n    setTimeout(() => {\n      ref.current?.scrollToOffset({ offset: 0, animated });\n    }, timeout);\n  };\n\n  // FIXME: Workaround, should run after data has been applied to UI.\n  const lazyScrollToIndex = (index = 0, animated = false, timeout = 0) => {\n    setTimeout(() => {\n      ref.current?.scrollToIndex({ index, animated, viewPosition: 0.5 });\n    }, timeout);\n  };\n\n  useEffect(() => {\n    if (props.searchItem) {\n      const createdAt = props.searchItem.startingPoint;\n      const foundMessageIndex = props.messages.findIndex((it) => it.createdAt === createdAt);\n      const isIncludedInList = foundMessageIndex > -1;\n      if (isIncludedInList) {\n        lazyScrollToIndex(foundMessageIndex, true, MESSAGE_SEARCH_SAFE_SCROLL_DELAY);\n      }\n    }\n  }, [props.searchItem]);\n\n  const scrollToBottom = useFreshCallback((animated = false) => {\n    if (props.hasNext()) {\n      props.onResetMessageList(() => {\n        lazyScrollToBottom(animated);\n        props.onScrolledAwayFromBottom(false);\n      });\n    } else {\n      lazyScrollToBottom(animated);\n    }\n  });\n\n  useChannelHandler(sdk, id, {\n    onReactionUpdated(channel, event) {\n      if (isDifferentChannel(channel, props.channel)) return;\n      const recentMessage = props.messages[0];\n      const isRecentMessage = recentMessage && recentMessage.messageId === event.messageId;\n      const scrollReachedBottomAndCanScroll = !props.scrolledAwayFromBottom && !props.hasNext();\n      if (isRecentMessage && scrollReachedBottomAndCanScroll) {\n        lazyScrollToBottom(true, 250);\n      }\n    },\n  });\n\n  useEffect(() => {\n    return subscribe(({ type }) => {\n      switch (type) {\n        case 'MESSAGES_RECEIVED': {\n          if (!props.scrolledAwayFromBottom) {\n            scrollToBottom(true);\n          }\n          break;\n        }\n        case 'MESSAGE_SENT_SUCCESS':\n        case 'MESSAGE_SENT_PENDING': {\n          scrollToBottom(false);\n          break;\n        }\n      }\n    });\n  }, [props.scrolledAwayFromBottom]);\n\n  return (\n    <ChannelMessageList\n      {...props}\n      ref={ref}\n      onEditMessage={setMessageToEdit}\n      onPressNewMessagesButton={scrollToBottom}\n      onPressScrollToBottomButton={scrollToBottom}\n    />\n  );\n};\n\nexport default React.memo(GroupChannelMessageList);\n"],"mappings":"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"}