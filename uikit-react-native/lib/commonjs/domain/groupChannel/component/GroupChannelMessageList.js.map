{"version":3,"names":["_react","_interopRequireWildcard","require","_uikitChatHooks","_uikitUtils","_ChannelMessageList","_interopRequireDefault","_constants","_useContext","_moduleContext","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","_extends","assign","bind","target","i","arguments","length","source","apply","GroupChannelMessageList","props","sdk","useSendbirdChat","setMessageToEdit","useContext","GroupChannelContexts","Fragment","subscribe","PubSub","id","useUniqHandlerId","ref","useRef","lazyScrollToBottom","animated","undefined","timeout","setTimeout","_ref$current","current","scrollToOffset","offset","lazyScrollToIndex","index","_ref$current2","scrollToIndex","viewPosition","useEffect","searchItem","createdAt","startingPoint","foundMessageIndex","messages","findIndex","it","isIncludedInList","MESSAGE_SEARCH_SAFE_SCROLL_DELAY","scrollToBottom","useFreshCallback","hasNext","onResetMessageList","onScrolledAwayFromBottom","useChannelHandler","onReactionUpdated","channel","event","isDifferentChannel","recentMessage","isRecentMessage","messageId","scrollReachedBottomAndCanScroll","scrolledAwayFromBottom","_ref","type","createElement","onEditMessage","onPressNewMessagesButton","onPressScrollToBottomButton","_default","React","memo","exports"],"sources":["GroupChannelMessageList.tsx"],"sourcesContent":["import React, { useContext, useEffect, useRef } from 'react';\nimport type { FlatList } from 'react-native';\n\nimport { useChannelHandler } from '@sendbird/uikit-chat-hooks';\nimport type { SendbirdMessage } from '@sendbird/uikit-utils';\nimport { isDifferentChannel, useFreshCallback, useUniqHandlerId } from '@sendbird/uikit-utils';\n\nimport ChannelMessageList from '../../../components/ChannelMessageList';\nimport { MESSAGE_SEARCH_SAFE_SCROLL_DELAY } from '../../../constants';\nimport { useSendbirdChat } from '../../../hooks/useContext';\nimport { GroupChannelContexts } from '../module/moduleContext';\nimport type { GroupChannelProps } from '../types';\n\nconst GroupChannelMessageList = (props: GroupChannelProps['MessageList']) => {\n  const { sdk } = useSendbirdChat();\n  const { setMessageToEdit } = useContext(GroupChannelContexts.Fragment);\n  const { subscribe } = useContext(GroupChannelContexts.PubSub);\n\n  const id = useUniqHandlerId('GroupChannelMessageList');\n  const ref = useRef<FlatList<SendbirdMessage>>(null);\n\n  // FIXME: Workaround, should run after data has been applied to UI.\n  const lazyScrollToBottom = (animated = false, timeout = 0) => {\n    setTimeout(() => {\n      ref.current?.scrollToOffset({ offset: 0, animated });\n    }, timeout);\n  };\n\n  // FIXME: Workaround, should run after data has been applied to UI.\n  const lazyScrollToIndex = (index = 0, animated = false, timeout = 0) => {\n    setTimeout(() => {\n      ref.current?.scrollToIndex({ index, animated, viewPosition: 0.5 });\n    }, timeout);\n  };\n\n  useEffect(() => {\n    if (props.searchItem) {\n      const createdAt = props.searchItem.startingPoint;\n      const foundMessageIndex = props.messages.findIndex((it) => it.createdAt === createdAt);\n      const isIncludedInList = foundMessageIndex > -1;\n      if (isIncludedInList) {\n        lazyScrollToIndex(foundMessageIndex, true, MESSAGE_SEARCH_SAFE_SCROLL_DELAY);\n      }\n    }\n  }, [props.searchItem]);\n\n  const scrollToBottom = useFreshCallback((animated = false) => {\n    if (props.hasNext()) {\n      props.onResetMessageList(() => {\n        lazyScrollToBottom(animated);\n        props.onScrolledAwayFromBottom(false);\n      });\n    } else {\n      lazyScrollToBottom(animated);\n    }\n  });\n\n  useChannelHandler(sdk, id, {\n    onReactionUpdated(channel, event) {\n      if (isDifferentChannel(channel, props.channel)) return;\n      const recentMessage = props.messages[0];\n      const isRecentMessage = recentMessage && recentMessage.messageId === event.messageId;\n      const scrollReachedBottomAndCanScroll = !props.scrolledAwayFromBottom && !props.hasNext();\n      if (isRecentMessage && scrollReachedBottomAndCanScroll) {\n        lazyScrollToBottom(true, 250);\n      }\n    },\n  });\n\n  useEffect(() => {\n    return subscribe(({ type }) => {\n      switch (type) {\n        case 'MESSAGES_RECEIVED': {\n          if (!props.scrolledAwayFromBottom) {\n            scrollToBottom(true);\n          }\n          break;\n        }\n        case 'MESSAGE_SENT_SUCCESS':\n        case 'MESSAGE_SENT_PENDING': {\n          scrollToBottom(false);\n          break;\n        }\n      }\n    });\n  }, [props.scrolledAwayFromBottom]);\n\n  return (\n    <ChannelMessageList\n      {...props}\n      ref={ref}\n      onEditMessage={setMessageToEdit}\n      onPressNewMessagesButton={scrollToBottom}\n      onPressScrollToBottomButton={scrollToBottom}\n    />\n  );\n};\n\nexport default React.memo(GroupChannelMessageList);\n"],"mappings":"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"}