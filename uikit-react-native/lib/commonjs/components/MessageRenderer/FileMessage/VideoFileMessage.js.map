{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_uikitReactNativeFoundation","_uikitUtils","_useContext","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","useRetry","videoFileUrl","retryCount","arguments","length","undefined","state","setState","useState","thumbnail","loading","retryCountRef","useRef","retryTimeoutRef","mediaService","usePlatformService","fetchThumbnail","getVideoThumbnail","url","timeMills","then","result","path","useEffect","reloadReservation","current","setTimeout","clearTimeout","VideoFileMessage","_ref","message","variant","children","colors","useUIKitTheme","fileUrl","getAvailableUriFromFileMessage","style","styles","video","backgroundColor","onBackground04","createElement","View","bubbleContainer","ui","groupChannelMessage","enabled","background","bubbleInnerContainer","PlayIcon","Image","source","uri","resizeMode","resizeMethod","Icon","icon","size","color","onBackground02","containerStyle","playIcon","onBackgroundReverse01","createStyleSheet","borderRadius","overflow","alignItems","justifyContent","width","maxWidth","height","position","padding","_default","exports"],"sources":["VideoFileMessage.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { View } from 'react-native';\n\nimport { Icon, Image, createStyleSheet, useUIKitTheme } from '@sendbird/uikit-react-native-foundation';\nimport { getAvailableUriFromFileMessage } from '@sendbird/uikit-utils';\n\nimport { usePlatformService } from '../../../hooks/useContext';\nimport type { FileMessageProps } from './index';\n\nconst useRetry = (videoFileUrl: string, retryCount = 5) => {\n  const [state, setState] = useState({ thumbnail: null as null | string, loading: true });\n  const retryCountRef = useRef(0);\n  const retryTimeoutRef = useRef<NodeJS.Timeout>();\n\n  const { mediaService } = usePlatformService();\n\n  const fetchThumbnail = () => {\n    return mediaService.getVideoThumbnail({ url: videoFileUrl, timeMills: 1000 }).then((result) => {\n      setState({ loading: false, thumbnail: result?.path ?? null });\n    });\n  };\n\n  useEffect(() => {\n    if (!state.thumbnail) {\n      const reloadReservation = () => {\n        if (retryCountRef.current < retryCount) {\n          retryTimeoutRef.current = setTimeout(() => {\n            retryCountRef.current++;\n            reloadReservation();\n            fetchThumbnail();\n          }, retryCountRef.current * 5000);\n        }\n      };\n\n      return reloadReservation();\n    } else {\n      return clearTimeout(retryTimeoutRef.current);\n    }\n  }, [state.thumbnail]);\n\n  return state;\n};\n\nconst VideoFileMessage = ({ message, variant, children }: FileMessageProps) => {\n  const { colors } = useUIKitTheme();\n\n  const fileUrl = getAvailableUriFromFileMessage(message);\n  const style = [styles.video, { backgroundColor: colors.onBackground04 }];\n\n  const { loading, thumbnail } = useRetry(fileUrl);\n\n  if (loading) {\n    return (\n      <View\n        style={[styles.bubbleContainer, { backgroundColor: colors.ui.groupChannelMessage[variant].enabled.background }]}\n      >\n        <View style={[styles.bubbleContainer, styles.bubbleInnerContainer]}>\n          <View style={style} />\n          <PlayIcon />\n        </View>\n        {children}\n      </View>\n    );\n  }\n\n  return (\n    <View\n      style={[styles.bubbleContainer, { backgroundColor: colors.ui.groupChannelMessage[variant].enabled.background }]}\n    >\n      <View style={[styles.bubbleContainer, styles.bubbleInnerContainer]}>\n        <Image source={{ uri: thumbnail || fileUrl }} style={style} resizeMode={'cover'} resizeMethod={'resize'} />\n        <PlayIcon />\n      </View>\n      {children}\n    </View>\n  );\n};\n\nconst PlayIcon = () => {\n  const { colors } = useUIKitTheme();\n\n  return (\n    <Icon\n      icon={'play'}\n      size={28}\n      color={colors.onBackground02}\n      containerStyle={[styles.playIcon, { backgroundColor: colors.onBackgroundReverse01 }]}\n    />\n  );\n};\n\nconst styles = createStyleSheet({\n  bubbleContainer: {\n    borderRadius: 16,\n    overflow: 'hidden',\n  },\n  bubbleInnerContainer: {\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n  video: {\n    width: 240,\n    maxWidth: 240,\n    height: 160,\n  },\n  playIcon: {\n    position: 'absolute',\n    padding: 10,\n    borderRadius: 50,\n  },\n});\n\nexport default VideoFileMessage;\n"],"mappings":"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"}