{"version":3,"names":["_react","_interopRequireWildcard","require","_uikitUtils","_Box","_interopRequireDefault","_Icon","_ImageWithPlaceholder","_PressBox","_createStyleSheet","_useUIKitTheme","_MessageContainer","obj","__esModule","default","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","VideoFileMessage","props","colors","palette","useUIKitTheme","onPress","onLongPress","rest","uri","getAvailableUriFromFileMessage","message","thumbnail","loading","useRetry","fetchThumbnailFromVideoSource","createElement","style","styles","container","activeOpacity","borderRadius","overflow","backgroundColor","onBackground04","width","height","source","iconContainer","alignItems","justifyContent","icon","size","color","onBackgroundLight02","containerStyle","playIcon","onBackgroundDark01","fetch","retryCount","arguments","length","undefined","state","setState","useState","retryCountRef","useRef","retryTimeoutRef","fetchThumbnail","current","useEffect","reloadReservation","setTimeout","then","result","path","clearTimeout","createStyleSheet","maxWidth","position","padding","_default","exports"],"sources":["Message.file.video.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\n\nimport type { SendbirdFileMessage } from '@sendbird/uikit-utils';\nimport { getAvailableUriFromFileMessage } from '@sendbird/uikit-utils';\n\nimport Box from '../../components/Box';\nimport Icon from '../../components/Icon';\nimport ImageWithPlaceholder from '../../components/ImageWithPlaceholder';\nimport PressBox from '../../components/PressBox';\nimport createStyleSheet from '../../styles/createStyleSheet';\nimport useUIKitTheme from '../../theme/useUIKitTheme';\nimport MessageContainer from './MessageContainer';\nimport type { OpenChannelMessageProps } from './index';\n\ntype Props = {\n  fetchThumbnailFromVideoSource: (uri: string) => Promise<{ path: string } | null>;\n};\nconst VideoFileMessage = (props: OpenChannelMessageProps<SendbirdFileMessage, Props>) => {\n  const { colors, palette } = useUIKitTheme();\n  const { onPress, onLongPress, ...rest } = props;\n  const uri = getAvailableUriFromFileMessage(props.message);\n  const { thumbnail, loading } = useRetry(() => props.fetchThumbnailFromVideoSource(uri));\n\n  return (\n    <MessageContainer {...rest}>\n      <PressBox style={styles.container} activeOpacity={0.8} onPress={onPress} onLongPress={onLongPress}>\n        <Box borderRadius={8} overflow={'hidden'} style={styles.container}>\n          {loading ? (\n            <Box backgroundColor={colors.onBackground04} style={{ width: '100%', height: '100%' }} />\n          ) : (\n            <ImageWithPlaceholder source={{ uri: thumbnail ?? 'invalid-image' }} width={'100%'} height={'100%'} />\n          )}\n\n          {(loading || thumbnail !== null) && (\n            <Box style={styles.iconContainer} alignItems={'center'} justifyContent={'center'}>\n              <Icon\n                icon={'play'}\n                size={28}\n                color={palette.onBackgroundLight02}\n                containerStyle={[styles.playIcon, { backgroundColor: palette.onBackgroundDark01 }]}\n              />\n            </Box>\n          )}\n        </Box>\n      </PressBox>\n    </MessageContainer>\n  );\n};\nconst useRetry = (fetch: () => Promise<{ path: string } | null>, retryCount = 5) => {\n  const [state, setState] = useState({ thumbnail: null as null | string, loading: true });\n  const retryCountRef = useRef(0);\n  const retryTimeoutRef = useRef<NodeJS.Timeout>();\n  const fetchThumbnail = useRef(fetch);\n  fetchThumbnail.current = fetch;\n\n  useEffect(() => {\n    if (!state.thumbnail) {\n      const reloadReservation = () => {\n        if (retryCountRef.current < retryCount) {\n          retryTimeoutRef.current = setTimeout(() => {\n            retryCountRef.current++;\n            reloadReservation();\n            fetchThumbnail.current().then((result) => {\n              setState({ loading: false, thumbnail: result?.path ?? null });\n            });\n          }, retryCountRef.current * 5000);\n        }\n      };\n\n      return reloadReservation();\n    } else {\n      return clearTimeout(retryTimeoutRef.current);\n    }\n  }, [state.thumbnail]);\n\n  return state;\n};\nconst styles = createStyleSheet({\n  container: {\n    maxWidth: 296,\n    height: 196,\n  },\n  iconContainer: {\n    position: 'absolute',\n    width: '100%',\n    height: '100%',\n  },\n  playIcon: {\n    padding: 10,\n    borderRadius: 50,\n  },\n});\nexport default VideoFileMessage;\n"],"mappings":"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"}