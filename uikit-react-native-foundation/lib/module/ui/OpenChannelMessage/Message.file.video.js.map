{"version":3,"names":["React","useEffect","useRef","useState","getAvailableUriFromFileMessage","Box","Icon","ImageWithPlaceholder","PressBox","createStyleSheet","useUIKitTheme","MessageContainer","VideoFileMessage","props","colors","palette","onPress","onLongPress","rest","uri","message","thumbnail","loading","useRetry","fetchThumbnailFromVideoSource","createElement","style","styles","container","activeOpacity","borderRadius","overflow","backgroundColor","onBackground04","width","height","source","iconContainer","alignItems","justifyContent","icon","size","color","onBackgroundLight02","containerStyle","playIcon","onBackgroundDark01","fetch","retryCount","arguments","length","undefined","state","setState","retryCountRef","retryTimeoutRef","fetchThumbnail","current","reloadReservation","setTimeout","then","result","path","clearTimeout","maxWidth","position","padding"],"sources":["Message.file.video.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\n\nimport type { SendbirdFileMessage } from '@sendbird/uikit-utils';\nimport { getAvailableUriFromFileMessage } from '@sendbird/uikit-utils';\n\nimport Box from '../../components/Box';\nimport Icon from '../../components/Icon';\nimport ImageWithPlaceholder from '../../components/ImageWithPlaceholder';\nimport PressBox from '../../components/PressBox';\nimport createStyleSheet from '../../styles/createStyleSheet';\nimport useUIKitTheme from '../../theme/useUIKitTheme';\nimport MessageContainer from './MessageContainer';\nimport type { OpenChannelMessageProps } from './index';\n\ntype Props = {\n  fetchThumbnailFromVideoSource: (uri: string) => Promise<{ path: string } | null>;\n};\nconst VideoFileMessage = (props: OpenChannelMessageProps<SendbirdFileMessage, Props>) => {\n  const { colors, palette } = useUIKitTheme();\n  const { onPress, onLongPress, ...rest } = props;\n  const uri = getAvailableUriFromFileMessage(props.message);\n  const { thumbnail, loading } = useRetry(() => props.fetchThumbnailFromVideoSource(uri));\n\n  return (\n    <MessageContainer {...rest}>\n      <PressBox style={styles.container} activeOpacity={0.8} onPress={onPress} onLongPress={onLongPress}>\n        <Box borderRadius={8} overflow={'hidden'} style={styles.container}>\n          {loading ? (\n            <Box backgroundColor={colors.onBackground04} style={{ width: '100%', height: '100%' }} />\n          ) : (\n            <ImageWithPlaceholder source={{ uri: thumbnail ?? 'invalid-image' }} width={'100%'} height={'100%'} />\n          )}\n\n          {(loading || thumbnail !== null) && (\n            <Box style={styles.iconContainer} alignItems={'center'} justifyContent={'center'}>\n              <Icon\n                icon={'play'}\n                size={28}\n                color={palette.onBackgroundLight02}\n                containerStyle={[styles.playIcon, { backgroundColor: palette.onBackgroundDark01 }]}\n              />\n            </Box>\n          )}\n        </Box>\n      </PressBox>\n    </MessageContainer>\n  );\n};\nconst useRetry = (fetch: () => Promise<{ path: string } | null>, retryCount = 5) => {\n  const [state, setState] = useState({ thumbnail: null as null | string, loading: true });\n  const retryCountRef = useRef(0);\n  const retryTimeoutRef = useRef<NodeJS.Timeout>();\n  const fetchThumbnail = useRef(fetch);\n  fetchThumbnail.current = fetch;\n\n  useEffect(() => {\n    if (!state.thumbnail) {\n      const reloadReservation = () => {\n        if (retryCountRef.current < retryCount) {\n          retryTimeoutRef.current = setTimeout(() => {\n            retryCountRef.current++;\n            reloadReservation();\n            fetchThumbnail.current().then((result) => {\n              setState({ loading: false, thumbnail: result?.path ?? null });\n            });\n          }, retryCountRef.current * 5000);\n        }\n      };\n\n      return reloadReservation();\n    } else {\n      return clearTimeout(retryTimeoutRef.current);\n    }\n  }, [state.thumbnail]);\n\n  return state;\n};\nconst styles = createStyleSheet({\n  container: {\n    maxWidth: 296,\n    height: 196,\n  },\n  iconContainer: {\n    position: 'absolute',\n    width: '100%',\n    height: '100%',\n  },\n  playIcon: {\n    padding: 10,\n    borderRadius: 50,\n  },\n});\nexport default VideoFileMessage;\n"],"mappings":"AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,OAAO;AAG1D,SAASC,8BAA8B,QAAQ,uBAAuB;AAEtE,OAAOC,GAAG,MAAM,sBAAsB;AACtC,OAAOC,IAAI,MAAM,uBAAuB;AACxC,OAAOC,oBAAoB,MAAM,uCAAuC;AACxE,OAAOC,QAAQ,MAAM,2BAA2B;AAChD,OAAOC,gBAAgB,MAAM,+BAA+B;AAC5D,OAAOC,aAAa,MAAM,2BAA2B;AACrD,OAAOC,gBAAgB,MAAM,oBAAoB;AAMjD,MAAMC,gBAAgB,GAAIC,KAA0D,IAAK;EACvF,MAAM;IAAEC,MAAM;IAAEC;EAAQ,CAAC,GAAGL,aAAa,EAAE;EAC3C,MAAM;IAAEM,OAAO;IAAEC,WAAW;IAAE,GAAGC;EAAK,CAAC,GAAGL,KAAK;EAC/C,MAAMM,GAAG,GAAGf,8BAA8B,CAACS,KAAK,CAACO,OAAO,CAAC;EACzD,MAAM;IAAEC,SAAS;IAAEC;EAAQ,CAAC,GAAGC,QAAQ,CAAC,MAAMV,KAAK,CAACW,6BAA6B,CAACL,GAAG,CAAC,CAAC;EAEvF,oBACEnB,KAAA,CAAAyB,aAAA,CAACd,gBAAgB,EAAKO,IAAI,eACxBlB,KAAA,CAAAyB,aAAA,CAACjB,QAAQ;IAACkB,KAAK,EAAEC,MAAM,CAACC,SAAU;IAACC,aAAa,EAAE,GAAI;IAACb,OAAO,EAAEA,OAAQ;IAACC,WAAW,EAAEA;EAAY,gBAChGjB,KAAA,CAAAyB,aAAA,CAACpB,GAAG;IAACyB,YAAY,EAAE,CAAE;IAACC,QAAQ,EAAE,QAAS;IAACL,KAAK,EAAEC,MAAM,CAACC;EAAU,GAC/DN,OAAO,gBACNtB,KAAA,CAAAyB,aAAA,CAACpB,GAAG;IAAC2B,eAAe,EAAElB,MAAM,CAACmB,cAAe;IAACP,KAAK,EAAE;MAAEQ,KAAK,EAAE,MAAM;MAAEC,MAAM,EAAE;IAAO;EAAE,EAAG,gBAEzFnC,KAAA,CAAAyB,aAAA,CAAClB,oBAAoB;IAAC6B,MAAM,EAAE;MAAEjB,GAAG,EAAEE,SAAS,IAAI;IAAgB,CAAE;IAACa,KAAK,EAAE,MAAO;IAACC,MAAM,EAAE;EAAO,EACpG,EAEA,CAACb,OAAO,IAAID,SAAS,KAAK,IAAI,kBAC7BrB,KAAA,CAAAyB,aAAA,CAACpB,GAAG;IAACqB,KAAK,EAAEC,MAAM,CAACU,aAAc;IAACC,UAAU,EAAE,QAAS;IAACC,cAAc,EAAE;EAAS,gBAC/EvC,KAAA,CAAAyB,aAAA,CAACnB,IAAI;IACHkC,IAAI,EAAE,MAAO;IACbC,IAAI,EAAE,EAAG;IACTC,KAAK,EAAE3B,OAAO,CAAC4B,mBAAoB;IACnCC,cAAc,EAAE,CAACjB,MAAM,CAACkB,QAAQ,EAAE;MAAEb,eAAe,EAAEjB,OAAO,CAAC+B;IAAmB,CAAC;EAAE,EACnF,CAEL,CACG,CACG,CACM;AAEvB,CAAC;AACD,MAAMvB,QAAQ,GAAG,SAAAA,CAACwB,KAA6C,EAAqB;EAAA,IAAnBC,UAAU,GAAAC,SAAA,CAAAC,MAAA,QAAAD,SAAA,QAAAE,SAAA,GAAAF,SAAA,MAAG,CAAC;EAC7E,MAAM,CAACG,KAAK,EAAEC,QAAQ,CAAC,GAAGlD,QAAQ,CAAC;IAAEkB,SAAS,EAAE,IAAqB;IAAEC,OAAO,EAAE;EAAK,CAAC,CAAC;EACvF,MAAMgC,aAAa,GAAGpD,MAAM,CAAC,CAAC,CAAC;EAC/B,MAAMqD,eAAe,GAAGrD,MAAM,EAAkB;EAChD,MAAMsD,cAAc,GAAGtD,MAAM,CAAC6C,KAAK,CAAC;EACpCS,cAAc,CAACC,OAAO,GAAGV,KAAK;EAE9B9C,SAAS,CAAC,MAAM;IACd,IAAI,CAACmD,KAAK,CAAC/B,SAAS,EAAE;MACpB,MAAMqC,iBAAiB,GAAGA,CAAA,KAAM;QAC9B,IAAIJ,aAAa,CAACG,OAAO,GAAGT,UAAU,EAAE;UACtCO,eAAe,CAACE,OAAO,GAAGE,UAAU,CAAC,MAAM;YACzCL,aAAa,CAACG,OAAO,EAAE;YACvBC,iBAAiB,EAAE;YACnBF,cAAc,CAACC,OAAO,EAAE,CAACG,IAAI,CAAEC,MAAM,IAAK;cACxCR,QAAQ,CAAC;gBAAE/B,OAAO,EAAE,KAAK;gBAAED,SAAS,EAAE,CAAAwC,MAAM,aAANA,MAAM,uBAANA,MAAM,CAAEC,IAAI,KAAI;cAAK,CAAC,CAAC;YAC/D,CAAC,CAAC;UACJ,CAAC,EAAER,aAAa,CAACG,OAAO,GAAG,IAAI,CAAC;QAClC;MACF,CAAC;MAED,OAAOC,iBAAiB,EAAE;IAC5B,CAAC,MAAM;MACL,OAAOK,YAAY,CAACR,eAAe,CAACE,OAAO,CAAC;IAC9C;EACF,CAAC,EAAE,CAACL,KAAK,CAAC/B,SAAS,CAAC,CAAC;EAErB,OAAO+B,KAAK;AACd,CAAC;AACD,MAAMzB,MAAM,GAAGlB,gBAAgB,CAAC;EAC9BmB,SAAS,EAAE;IACToC,QAAQ,EAAE,GAAG;IACb7B,MAAM,EAAE;EACV,CAAC;EACDE,aAAa,EAAE;IACb4B,QAAQ,EAAE,UAAU;IACpB/B,KAAK,EAAE,MAAM;IACbC,MAAM,EAAE;EACV,CAAC;EACDU,QAAQ,EAAE;IACRqB,OAAO,EAAE,EAAE;IACXpC,YAAY,EAAE;EAChB;AACF,CAAC,CAAC;AACF,eAAelB,gBAAgB"}